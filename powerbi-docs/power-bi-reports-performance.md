---
title: แนวทางปฏิบัติที่ดีที่สุดเพื่อประสิทธิภาพการทำงานของ Power BI
description: บทความนี้มีคำแนะนำสำหรับการสร้างรายงานอย่างรวดเร็ว และเชื่อถือได้ใน Power BI
author: MarkMcGeeAtAquent
ms.author: kfile
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.component: powerbi-service
ms.topic: conceptual
ms.date: 05/18/2018
LocalizationGroup: Reports
ms.openlocfilehash: eb2e667f6a6b037e2bb0f4b7543f2e7d90617050
ms.sourcegitcommit: 298db44200b78b1281b3ae6dfe7cce7a89865ec9
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 12/13/2018
ms.locfileid: "53329774"
---
# <a name="power-bi-performance-best-practices"></a>แนวทางปฏิบัติที่ดีที่สุดเพื่อประสิทธิภาพการทำงานของ Power BI

บทความนี้มีคำแนะนำสำหรับการสร้างรายงานอย่างรวดเร็ว และเชื่อถือได้ใน Power BI  

## <a name="use-filters-to-limit-report-visuals-to-display-only-whats-needed"></a>ใช้ตัวกรองเพื่อจำกัดวิชวลในรายงานให้แสดงเฉพาะที่จำเป็น 

ยิ่งวิชวลต้องแสดงข้อมูลมากขึ้นเท่าไร วิชวลจะยิ่งโหลดช้าลงเท่านั้น แม้ว่าหลักนี้จะดูตรงไปตรงมา แต่ก็ลืมได้ง่าย ตัวอย่างเช่น: สมมติว่าคุณมีชุดข้อมูลขนาดใหญ่ ยิ่งกว่านั้น คุณสร้างรายงานที่มีตารางของตาราง ผู้ใช้ปลายทางใช้ตัวแบ่งส่วนข้อมูลบนหน้า เพื่อเข้าถึงแถวที่พวกเขาต้องการ – โดยทั่วไปแล้วพวกเขาสนใจเฉพาะแถวไม่กี่สิบแถว

ข้อผิดพลาดที่พบบ่อยคือ ใช้มุมมองตามค่าเริ่มต้นของตารางที่ยังไม่ได้กรอง - นั่นคือแถวทั้งหมดที่มีซึ่งอาจมีมากกว่า 100 ล้านแถว ข้อมูลสำหรับแถวเหล่านี้ต้องโหลดลงในหน่วยความจำ และขยายข้อมูลกลับทุกครั้งที่รีเฟรช ซึ่งสร้างการโหลดขนาดใหญ่กับหน่วยความจำ ทางแก้: ลดจำนวนสูงสุดของรายการที่แสดงตารางโดยใช้ตัวกรอง "Top N" จำนวนรายการสูงสุด สามารถมีได้มากกว่าที่ผู้ใช้จำเป็น เช่น 10000 รายการ ผลที่ได้คือ ประสบการณ์การใช้งานของผู้ใช้ไม่เปลี่ยนแปลง แต่การใช้หน่วยความจำของรายงานลดลงอย่างมาก และประสิทธิภาพการทำงานดีตามไปด้วย

แนวทางแบบเดียวกับข้างบน เป็นแนวทางที่แนะนำสำหรับวิชวลทั้งหมดในรายงานของคุณ ถามตัวคุณเอง ข้อมูลทั้งหมดในวิชวลนี้จำเป็นหรือไม่? มีวิธีไหนที่ใช้กรองข้อมูลให้น้อยลง โดยที่ส่งผลต่อประสบการณ์การใช้งานของผู้ใช้ปลายทางน้อยที่สุด โปรดทราบว่าตารางสามารถใช้ทรัพยากรสูง

## <a name="limit-visuals-on-report-pages"></a>จำกัดวิชวลบนหน้ารายงาน

หลักการด้านบนสามารถนำไปใช้กับ จำนวนวิชวลบนรายงานใดรายงานหนึ่ง เราแนะนำให้คุณจำกัดจำนวนของวิชวลบนรายงาน ให้มีวิชวลเฉพาะเท่าที่จำเป็น หน้าดูข้อมูลแบบละเอียด เป็นวิธีที่ดีเพื่อเพิ่มรายละเอียดโดยไม่ต้องใส่วิชวลเพิ่มลงในรายงาน  

## <a name="optimize-your-model"></a>ปรับรูปแบบข้อมูลของคุณให้เหมาะสม

หลักปฏิบัติที่ดีที่สุดบางประการ:

- ตารางหรือคอลัมน์ไหนที่ไม่ได้ใช้งานควรนำออกไปถ้าเป็นไปได้ 
- หลีกเลี่ยงคอลัมน์ที่มีคาร์ดินาลลิตี้สูง – นั่นคือมีจำนวนนับค่าที่ต่างกันเป็นจำนวนหลายล้านค่า  
- พยายามหลีกเลี่ยงเขตข้อมูลที่มีความแม่นยำมากเกินความจำเป็นและมีคาร์ดินาลลิตี้สูง ตัวอย่างเช่น คุณสามารถแยกค่า วันที่เวลา ซึ่งไม่ค่อยซ้ำกัน เป็นหลายคอลัมน์แยกจากกัน ตัวอย่างเช่น วัน เดือน ปี เป็นต้น หรือถ้าเป็นไปได้ ใช้การปัดเศษเขตข้อมูลความแม่นยำสูง เมื่อต้องลดคาร์ดินาลลิตี้ – (ตัวอย่างเช่น 13.29889 -> 13.3)
- ใช้จำนวนเต็มแทนสตริง ถ้าทำได้
- ระมัดระวังการใช้งานฟังก์ชัน DAX ที่จำเป็นต้องทดสอบทุกแถวในตาราง – ตัวอย่างเช่น RANKX – ในกรณีที่แย่ที่สุด ฟังก์ชันเหล่านี้สามารถเพิ่มเวลาการทำงานและหน่วยความจำที่ต้องใช้เป็นแบบเอ็กซ์โพเนนเชียล เมื่อขนาดของตารางเพิ่มขึ้นแบบเส้นตรง
- เมื่อเชื่อมต่อกับแหล่งข้อมูลผ่านทาง DirectQuery พิจารณาทำคอลัมน์ที่ต้องกรองหรือแบ่งส่วนบ่อย ๆ ให้เป็นคอลัมน์ดัชนี – สิ่งนี้จะช่วยปรับปรุงตอบสนองของรายงานเป็นอย่างมาก  

สำหรับคำแนะนำเพิ่มเติมเกี่ยวกับการปรับแหล่งข้อมูลให้เหมาะสมสำหรับ DirectQuery ดู [DirectQuery ใน SQL Server 2016 Analysis Services](https://blogs.msdn.microsoft.com/analysisservices/2017/04/06/directquery-in-sql-server-2016-analysis-services-whitepaper/)

## <a name="directquery-and-live-connection-understand-underlying-data-source-performance"></a>การเชื่อมต่อ DirectQuery และเชื่อมต่อสด: ทำความเข้าใจประสิทธิภาพของแหล่งข้อมูลพื้นฐาน

ในกรณีที่เป็นการชื่อมต่อ DirectQuery หรือการเชื่อมต่อสด เมื่อผู้ใช้เยี่ยมชมรายงาน Power BI จะส่งคิวรีในแบบเรียลไทม์ไปยังแหล่งข้อมูลพื้นฐาน ทันทีที่แหล่งข้อมูลส่งข้อมูลคิวรีกลับมา รายงานก็จะแสดงผล ดังนั้นในกรณีนี้ ประสิทธิภาพของแหล่งข้อมูลพื้นฐาน มีผลอย่างมากต่อประสิทธิภาพการทำงานของรายงานของคุณ

การทำความเข้าใจประสิทธิภาพของแหล่งข้อมูลพื้นฐานของคุณเป็นสิ่งสำคัญ แหล่งข้อมูลแต่ละแหล่ง จะมีเครื่องมือที่แตกต่างกันสำหรับการทำความเข้าใจประสิทธิภาพการคิวรี ตัวอย่างเช่น SQL Server และ Azure SQL มี Query Store ซึ่งบันทึกประวัติคิวรี และสถิตการทำงาน

กฎที่ใช้ได้เสมอคือ เมื่อปรับใช้รายงาน Power BI ที่ใช้ DirectQuery และเชื่อมต่อสด ลองสิ่งที่ผู้ใช้ของคุณจะทำใน Power BI Desktop ถ้ารายงานโหลดใน Power BI Desktop ช้า เกือบจะแน่นอนที่ผู้ใช้ของคุณจะโหลดจากบริการช้าตามไปด้วย 

## <a name="directquery-best-practices"></a>แนวทางปฏิบัติที่ดีที่สุดสำหรับ DirectQuery

ส่วนต่อไปนี้อธิบายหลักปฏิบัติที่ดีที่สุด สำหรับการเชื่อมต่อผ่านทาง DirectQuery
  
### <a name="db-design-guidance"></a>คำแนะนำการออกแบบฐานข้อมูล

- ผลักให้คอลัมน์จากการคำนวณและหน่วยวัด เข้าใกล้แหล่งข้อมูลเท่าที่ทำได้ – ยิ่งอยู่ใกล้แหล่งข้อมูล ประสิทธิภาพน่าจะยิ่งสูงขึ้นด้วย
- ปรับให้เหมาะสม! ทำความเข้าใจการทำงานของคิวรีคุณ เพิ่มดัชนีสำหรับคอลัมน์ที่ถูกกรองบ่อย ฯลฯ

### <a name="modeling-guidance"></a>แนวทางการสร้างแบบจำลอง

- เริ่มต้นใน Power BI Desktop
- หลีกเลี่ยงคิวรีที่ซับซ้อนในตัวแก้ไขคิวรี
- ไม่ใช้การกรองวันที่แบบสัมพัทธ์ในตัวแก้ไขคิวรี  
- เริ่มต้นด้วยหน่วยวัดที่ง่าย ๆ แล้วค่อยเพิ่มความซับซ้อนทีละเล็กทีละน้อย
- หลีกเลี่ยงความสัมพันธ์บนคอลัมน์จากการคำนวณ และคอลัมน์ตัวระบุที่ไม่ซ้ำกัน
- ลองตั้งค่า "ประมาณ Referential Integrity" บนความสัมพันธ์ – ในหลายกรณี นี่สามารถปรับปรุงประสิทธิภาพการทำงานคิวรีอย่างมาก  

### <a name="general"></a>ทั่วไป

- ใช้ตัวกรองก่อน
- พิจารณาปิดการปฏิสัมพันธ์ระหว่างวิชวล – สิ่งนี้จะช่วยลดปริมาณคิวรีเมื่อผู้ใช้ใช้ไฮไลต์แบบเชื่อมโยง
- จำกัดจำนวนของวิชวลและข้อมูลสำหรับแต่ละวิชวล ตามที่อธิบายไว้ด้านบน
- เปิดใช้งานการรักษาความปลอดภัยระดับแถว สามารถเพิ่มประสิทธิภาพได้มาก ตรวจสอบให้แน่ใจว่าได้ทดสอบความปลอดภัยระดับแถว ด้วยบทบาทผู้ใช้ที่แตกต่างกันที่ผู้ใช้ของคุณจะมีได้
- มีการบริการกำหนดเวลาสูงสุดของคิวรี เพื่อให้แน่ใจว่าคิวรีที่ทำงานนาน ๆ จะไม่สามารถยึดทรัพยากรทั้งหมดของระบบเอาไว้เป็นของตัวเอง คิวรีที่ใช้เวลานานกว่า 225 วินาทีจะหมดเวลา และเกิดเป็นข้อผิดพลาดในระดับวิชวล

## <a name="understand-dashboards-and-query-caches"></a>การทำความเข้าใจแดชบอร์ดและแคชของคิวรี

วิชวลที่ปักหมุดกับแดชบอร์ด ถูกบริการโดยแคชของคิวรีเมื่อแดชบอร์ดถูกโหลด ในทางกลับกัน เมื่อเปิดดูรายงาน คิวรีจะถูกสร้างขึ้นเดี๋ยวนั้นไปยังแหล่งข้อมูล – ซึ่งอาจะเป็น บริการของ Power BI (ในกรณีของการนำเข้า) หรือแหล่งข้อมูลที่คุณระบุ (ในกรณีของ DirectQuery หรือการเชื่อมต่อสด)  

> [!NOTE]
> เมื่อคุณปักหมุดรายงานไทล์แบบสดบนแดชบอร์ด ไทล์เหล่านั้นไม่ถูกบริการด้วยแคชของคิวรี – แต่จะทำงานเหมือนรายงาน และทำคิวรีทุกครั้งที่ใช้งาน

ซึ่งก็เป็นไปตามชื่อ การดึงข้อมูลจากแคชคิวรี มีประสิทธิภาพที่ดีกว่าและสม่ำเสมอกว่าการพึ่งพาแหล่งข้อมูล วิธีหนึ่งที่ใช้ประโยชน์จากความสามารถนี้ คือให้แดชบอร์ดเป็นเพจเริ่มต้นสำหรับผู้ใช้ของคุณ ปักหมุดวิชวลที่เรียกใช้บ่อยไปยังแดชบอร์ด ด้วยวิธีนี้ แดชบอร์ดที่กลายเป็น "ปราการด่านแรก" ซึ่งมีประสิทธิภาพที่เสมอต้นเสมอปลาย และกินโหลดความจุน้อยลง ผู้ใช้ยังคงสามารถคลิกเข้าไปในรายงานลงไปในรายละเอียด  
 

สำหรับ DirectQuery และการเชื่อมต่อสด แคชของคิวรีนี้มีการปรับปรุงเป็นระยะ ๆ ด้วยการคิวรีแหล่งข้อมูล ตามค่าเริ่มต้น สิ่งนี้จะเกิดขึ้นทุก ๆ ชั่วโมง แต่คุณสามารถกำหนดค่าใหม่ด้วยการตั้งค่าชุดข้อมูล ทุก ๆ การปรับปรุงแคชของคิวรี จะส่งคิวรีไปยังแหล่งข้อมูลพื้นฐานเพื่อปรับปรุงแคช จำนวนคิวที่สร้างขึ้น ขึ้นอยู่กับจำนวนวิชวลที่ปักหมุดไปยังแดชบอร์ดที่ใช้แหล่งข้อมูลนั้น โปรดสังเกตว่า ถ้าเปิดใช้งานความปลอดภัยระดับแถว คิวรีจะสร้างขึ้นสำหรับแต่ละบริบทความปลอดภัยที่แตกต่างกัน ตัวอย่างเช่น ถ้าคุณมีสองบทบาทที่ผู้ใช้ของคุณสามารถเป็นได้ และมีสองมุมมองที่แตกต่างกันของข้อมูล ในระหว่างการรีเฟรชแคชของคิวรี จะสร้างคิวรีขึ้นสองชุด 

## <a name="understand-custom-visual-performance"></a>ทำความเข้าใจประสิทธิภาพวิชวลแบบกำหนดเอง 

ตรวจสอบให้แน่ใจว่าได้ทดสอบแต่ละวิชวลแบบกำหนดเองอย่างละเอียดเพื่อให้แน่ใจว่ามีประสิทธิภาพการทำงานสูง วิชวลแบบกำหนดเองที่ปรับแต่งได้ไม่ดี สามารถส่งผลเสียต่อประสิทธิภาพการทำงานของทั้งรายงาน 

## <a name="deep-dive-into-query-performance-with-sql-profiler-and-power-bi-desktop"></a>เจาะลึกลงในประสิทธิภาพคิวรี ด้วย SQL Profiler และ Power BI Desktop

สำหรับการเจาะลึกลงไปเพื่อหาว่าวิชวลใดใช้เวลาและทรัพยากรมากที่สุด คุณสามารถเชื่อมต่อ SQL Profiler กับ Power BI Desktop เพื่อเห็นภาพทั้งหมดของประสิทธิภาพคิวรี

> [!NOTE]
> Power BI desktop สนับสนุนการเชื่อมต่อเข้ากับพอร์ตการวินิจฉัย พอร์ตการวินิจฉัยอนุญาตให้เครื่องมืออื่น ๆ เชื่อมต่อและดำเนินการติดตามเพื่อการวินิจฉัย *ไม่สนับสนุนการทำการเปลี่ยนแปลงใด ๆ ลงในรูปแบบ การเปลี่ยนแปลงไปยังรูปแบบอาจทำให้ข้อมูลเสียหายและสูญหายได้*

ต่อไปนี้คือวิธีปฏิบัติ:
  
1. **ติดตั้ง SQL Server Profiler และเรียกใช้ Power BI Desktop**

   SQL Server Profiler มีให้ใช้งานเป็นส่วนหนึ่งของ SQL Server Management Studio

2. **ค้าหาพอร์ตที่ถูกใช้โดย Power BI Desktop**

   เรียกใช้พร้อมท์คำสั่งหรือ PowerShell ด้วยสิทธิ์ระดับผู้ดูแลระบบ และใช้คำสั่ง netstat เพื่อหาพอร์ตที่ Power BI Desktop ใช้ สำหรับการวิเคราะห์:

   `> netstat -b -n`

   ผลลัพธ์ควรเป็นรายการของแอปพลิเคชันและพอร์ตที่เปิด ตัวอย่างเช่น:  

   `TCP    [::1]:55786            [::1]:55830            ESTABLISHED`

   [msmdsrv.exe]

   ค้นหาพอร์ตที่ใช้โดย msmdsrv.exe และบันทึกไว้ใช้ในภายหลัง ในกรณีนี้ คุณใช้พอร์ต 55786
3. **เชื่อมต่อ SQL Server Profiler ไปยัง Power BI Desktop**

   - เริ่มตัว SQL Server Profiler จากเมนู**เริ่มต้น**
   - **แฟ้ม** > **การติดตามใหม่**
   - ชนิดของเซิร์ฟเวอร์: บริการด้านการวิเคราะห์
   - ชื่อเซิร์ฟเวอร์: localhost: [หมายเลขพอร์ตที่พบด้านบน]
   - ที่หน้าจอถัดไป เลือก**เรียกใช้**
   - ในตอนนี้ SQL Profiler ทำงานแล้ว และกำลังโพรไฟล์คิวรีที่ Power BI Desktop กำลังส่ง 
   - เมื่อมีดำเนินการคิวรี คุณสามารถดูช่วงเวลาที่เกี่ยวข้องและเวลาที่ CPU ใช้ – ด้วยข้อมูลนี้ คุณสามารถหาได้ว่าคิวรีไหนที่เป็นปัญหาคอขวด  

ด้วย SQL Profiler คุณสามารถระบุคิวรีที่ใช้เวลาของ CPU สูงสุด ซึ่งน่าจะเป็นปัญหาคอขวดประสิทธิภาพการทำงาน วิชวลที่ใช้งานคิวรีเหล่านั้นควรมีเป้าหมายสำหรับการปรับปรุงประสิทธิภาพต่อไป

## <a name="gateway-best-practices"></a>แนวทางปฏิบัติที่ดีที่สุดสำหรับเกตเวย์

เกตเวย์ข้อมูลภายในองค์กร เป็นเครื่องมือที่ยอดเยี่ยมสำหรับการเชื่อมต่อบริการของ Power BI กับข้อมูลภายในองค์กรของคุณ ในเวลาเดียวกัน ถ้าวางแผนได้ไม่ดี ก็กลายเป็นคอขวดของประสิทธิภาพรายงานได้เช่นกัน โดยเฉพาะอย่างยิ่งสำหรับการเชื่อมต่อ DirectQuery/เชื่อมต่อสด กับชุดข้อมูล ซึ่งทุกคิวรีและคำตอบของคิวรีทั้งหมดต้องผ่านเกตเวย์ ต่อไปนี้คือ บางแนวทางปฏิบัติที่ดีที่สุด เพื่อแน่ใจว่าเกตเวย์ทำงานด้วยประสิทธิภาพที่สูง: 

- **ใช้โหมดองค์กร** แทนที่จะเป็นโหมดส่วนตัว
- **ขอแนะนำข้อมูลจำเพาะของฮาร์ดแวร์สำหรับเกตเวย์** – CPU แปดแกน, 16 GB RAM
- **ตั้งค่าการตรวจสอบ** – การตั้งค่าการตรวจสอบประสิทธิภาพการทำงานบนเครื่องเกตเวย์ เพื่อให้ทราบว่าเกตเวย์เกิดโอเวอร์โหลด และกลายเป็นคอขวดหรือไม่ สำหรับข้อมูลเพิ่มเติม ดู[การแก้ไขปัญหาเกตเวย์ข้อมูลภายในองค์กร](service-gateway-onprem-tshoot.md)
- **Scale up หรือ scale out** – ถ้าเกตเวย์คือคอขวดจริง ๆ จาก นั้นลอง scale up (นั่นคือ ย้ายเกตเวย์ไปยังเครื่องที่มีพลังมากขึ้นด้วย CPU และ RAM ที่มากกว่า) หรือ scale out (ตัวอย่าง แยกชุดข้อมูลไปยังเกตเวย์อื่น) 
- **แยกการนำเข้า กับ DirectQuery** – ถ้าทำ scale out พิจารณาแยกเกตเวย์ที่รับผิดชอบการนำเข้าข้อมูล กับเกตเวย์ที่รับผิดชอบ DirectQuery

## <a name="network-latency"></a>เวลาแฝงในการส่งข้อมูลบนเครือข่าย

เวลาแฝงในการส่งข้อมูลบนเครือข่าย ส่งผลต่อประสิทธิภาพของรายงานได้ โดยการเพิ่มเวลาของคำขอที่จะไปถึงบริการของ Power BI และเวลาของการตอบกลับมา ผู้เช่าใน Power BI จะถูกกำหนดภูมิภาคให้เฉพาะ คุณสามารถดูภูมิภาค "บ้าน" ของผู้เช่าของคุณ โดยไปยัง powerbi.com เลือก?** ที่ด้านขวาบนและจากนั้น **เกี่ยวกับ Power BI** เมื่อผู้ใช้จากผู้เช่าเข้าถึงบริการ Power BI คำขอของพวกเขาจะวิ่งมาที่ภูมิภาคนี้เสมอ เมื่อคำขอเข้าถึงบริการของ Power BI แล้ว บริการอาจแล้วส่งคำขอเพิ่มเติม – ตัวอย่างเช่น ไปยังแหล่งข้อมูลพื้นฐานหรือเกตเวย์ – ซึ่งได้รับผลกระทบจากเวลาแฝงบนเครือข่ายด้วย

เครื่องมือเช่น [Azure Speed Test](http://azurespeedtest.azurewebsites.net/) สามารถหาเวลาแฝงบนเครือข่ายระหว่างไคลเอ็นต์และภูมิภาค Azure ได้ โดยทั่วไป พยายามให้แหล่งข้อมูล เกตเวย์ และคลัสเตอร์ Power BI ของคุณอยู่ใกล้กันมากที่สุด เพื่อลดผลกระทบของเวลาแฝงบนเครือข่าย ถ้าเเวลาแฝงในการส่งข้อมูลบนเครือข่ายคือตัวปัญหา คุณลองย้ายเกตเวย์และแหล่งข้อมูลมาใกล้กับคลัสเตอร์ Power BI ของคุณมากขึ้น โดยการวางบนเครื่องเสมือน

เพื่อปรับปรุงเวลาแฝงบนเครือข่ายเพิ่มเติม พิจารณาใช้ [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) ซึ่งสามารถสร้างการเชื่อมต่อเครือข่ายที่เร็วกว่า และเชื่อถือได้มากกว่าระหว่างไคลเอ็นต์ของคุณ และศูนย์ข้อมูล Azure

## <a name="next-steps"></a>ขั้นตอนถัดไป

- [วางแผนการปรับใช้งาน Power BI Enterprise](https://aka.ms/pbienterprisedeploy) ด้วยคำแนะนำรอบด้านในการปรับใช้ Power BI ขนาดใหญ่
- [DirectQuery ใน SQL Server 2016 Analysis Services](https://blogs.msdn.microsoft.com/analysisservices/2017/04/06/directquery-in-sql-server-2016-analysis-services-whitepaper/)
- [[YouTube] สร้างรายงานที่เร็วและเชื่อถือได้ใน Power BI](https://www.youtube.com/watch?v=GhiJABR7XX0)
- [[YouTube] การปรับใช้งาน Power BI Enterprise](https://www.youtube.com/watch?v=K-zEWICvICM)