---
title: 'บทช่วยสอน: เชื่อมต่อกับข้อมูลภายในองค์กรใน SQL Server'
description: เรียนรู้วิธีใช้ SQL Server เป็นเกตเวย์แหล่งข้อมูล รวมถึงวิธีการรีเฟรชข้อมูล
author: arthiriyer
ms.reviewer: kayu
ms.service: powerbi
ms.subservice: powerbi-gateways
ms.topic: tutorial
ms.date: 07/15/2019
ms.author: arthii
LocalizationGroup: Gateways
ms.openlocfilehash: 100417202fca148be0e2e976ce0cd84167c803d9
ms.sourcegitcommit: 0e9e211082eca7fd939803e0cd9c6b114af2f90a
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 05/13/2020
ms.locfileid: "83283519"
---
# <a name="refresh-data-from-an-on-premises-sql-server-database"></a>รีเฟรชข้อมูลจากฐานข้อมูล SQL Server ภายในองค์กร

ในบทช่วยสอนนี้ คุณจะสำรวจวิธีการรีเฟรชชุดข้อมูล Power BI จากฐานข้อมูลเชิงสัมพันธ์ที่มีอยู่ภายในองค์กรในเครือข่ายเฉพาะที่ของคุณ โดยเฉพาะ บทช่วยสอนนี้ใช้ฐานข้อมูล SQL Server ตัวอย่าง ซึ่ง Power BI ต้องเข้าถึงผ่านเกตเวย์ข้อมูลภายในองค์กร

ในบทช่วยสอนนี้ คุณจะทำขั้นตอนต่อไปนี้ให้เสร็จสมบูรณ์:

> [!div class="checklist"]
> * สร้าง และเผยแพร่ไฟล์ Power BI Desktop (.pbix) ที่นำเข้าข้อมูลจากฐานข้อมูล SQL Server ภายในองค์กร
> * กำหนดการตั้งค่าชุดข้อมูลและแหล่งข้อมูลใน Power BI สำหรับการเชื่อมต่อ SQL Server ผ่านเกตเวย์ข้อมูล
> * กำหนดตารางการรีเฟรชเพื่อให้แน่ใจว่าชุดข้อมูล Power BI ของคุณมีข้อมูลล่าสุด
> * ดำเนินการรีเฟรชตามความต้องการของชุดข้อมูล
> * ตรวจสอบประวัติการรีเฟรชเพื่อวิเคราะห์ผลลัพธ์ของรอบการรีเฟรชในอดีต
> * ล้างแหล่งข้อมูล โดยการลบอาร์ทิแฟกต์ที่สร้างขึ้นในบทช่วยสอนนี้

## <a name="prerequisites"></a>ข้อกำหนดเบื้องต้น

- ถ้าคุณไม่มี ให้ลงทะเบียนสำหรับ[ทดลองใช้ Power BI ฟรี](https://app.powerbi.com/signupredirect?pbi_source=web)ก่อนที่จะเริ่ม
- [ติดตั้ง Power BI Desktop](https://powerbi.microsoft.com/desktop/) ภายในคอมพิวเตอร์
- [ติดตั้ง SQL Server](/sql/database-engine/install-windows/install-sql-server) ภายในคอมพิวเตอร์ และคืนค่า [ฐานข้อมูลตัวอย่างจากการสำรองข้อมูล](https://github.com/Microsoft/sql-server-samples/releases/download/adventureworks/AdventureWorksDW2017.bak) สำหรับข้อมูลเพิ่มเติมเกี่ยวกับ AdventureWorks ให้ดู [การติดตั้งและการกำหนดค่า AdventureWorks](/sql/samples/adventureworks-install-configure)
- [ติดตั้งเกตเวย์ข้อมูลภายในองค์กร](service-gateway-onprem.md) ภายในคอมพิวเตอร์เครื่องเดียวกันเป็น SQL Server (แต่ในการใช้งานจริง มักจะเป็นคอมพิวเตอร์คนละเครื่อง)

> [!NOTE]
> ถ้าคุณไม่ได้เป็นผู้ดูแลระบบเกตเวย์ และไม่ต้องการติดตั้งเกตเวย์ด้วยตนเอง ติดต่อผู้ดูแลระบบเกตเวย์ในองค์กรของคุณ พวกเขาสามารถสร้างข้อกำหนดแหล่งข้อมูลที่จำเป็นต้องมีการเชื่อมต่อชุดข้อมูลของคุณลงในฐานข้อมูล SQL Server

## <a name="create-and-publish-a-power-bi-desktop-file"></a>สร้าง และเผยแพร่ไฟล์ Power BI Desktop

ใช้ขั้นตอนต่อไปนี้เพื่อสร้างรายงาน Power BI พื้นฐานโดยใช้ฐานข้อมูลตัวอย่าง AdventureWorksDW เผยแพร่รายงานไปยังบริการของ Power BI เพื่อให้คุณรับชุดข้อมูลใน Power BI ซึ่งคุณสามารถกำหนดค่าแล้ว และรีเฟรชในขั้นตอนต่อไป

1. ใน Power BI Desktop บนแท็บ**หน้าแรก** ให้เลือก **รับข้อมูล** \> **SQL Server**

2. ในกล่องโต้ตอบ**ฐานข้อมูล SQL Server** ให้ใส่ชื่อ **เซิร์ฟเวอร์**และ**ฐานข้อมูล (ไม่บังคับ)** ชื่อ ให้แน่ใจว่า**โหมดการเชื่อมต่อข้อมูล** เป็น**นำเข้า**แล้ว เลือก**ตกลง**

    ![ฐานข้อมูล SQL Server](./media/service-gateway-sql-tutorial/sql-server-database.png)

    เราไม่ได้ใช้**ตัวเลือกขั้นสูง**  ในบทช่วยสอนนี้แต่โปรดทราบว่าคุณสามารถระบุคำสั่ง SQL และตั้งค่าตัวเลือกอื่นๆเช่นการใช้[SQL Server ล้มเหลว](/sql/database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server)

    ![SQL Server ตัวเลือกขั้นสูง](media/service-gateway-sql-tutorial/sql-server-advanced-options.png)

3. ตรวจสอบ**ข้อมูลประจำตัว**ของคุณ จากนั้นเลือก **เชื่อมต่อ**

    > [!NOTE]
    > ถ้าคุณไม่สามารถรับรองความถูกต้องได้ ให้แน่ใจว่าคุณได้เลือกวิธีการรับรองความถูกต้องที่ถูกต้อง และใช้บัญชีผู้ใช้ที่มีสิทธิเข้าถึงฐานข้อมูล ในสภาพแวดล้อมการทดสอบ คุณอาจใช้การรับรองความถูกต้องของฐานข้อมูลด้วยชื่อผู้ใช้และรหัสผ่านที่ชัดเจน ในสภาพแวดล้อมการทำงานจริง คุณมักใช้การรับรองความถูกต้องของ Windows ดูที่ [การแก้ไขปัญหาสถานการณ์การรีเฟรช](refresh-troubleshooting-refresh-scenarios.md)และติดต่อผู้ดูแลระบบฐานข้อมูลสำหรับความช่วยเหลือเพิ่มเติม

1. ถ้ากล่องโต้ตอบ**การสนับสนุนการเข้ารหัสลับ**ปรากฏขึ้น ให้เลือก**ตกลง**

2. ในกล่องโต้ตอบ**ตัวนำทาง** ให้เลือกตาราง **DimProduct** จากนั้นเลือก**โหลด**

    ![ตัวนำทางของแหล่งข้อมูล](./media/service-gateway-sql-tutorial/data-source-navigator.png)

3. ใน Power BI Desktop มุมมอง**รายงาน** ในบานหน้าต่าง**การจัดรูปแบบการแสดงข้อมูล** เลือก**แผนภูมิคอลัมน์แบบเรียงซ้อน**

    ![แผนภูมิคอลัมน์แบบเรียงซ้อน](./media/service-gateway-sql-tutorial/stacked-column-chart.png)

4. ด้วยแผนภูมิคอลัมน์ที่เลือกในพื้นที่รายงาน ในบานหน้าต่าง**เขตข้อมูล**เลือกเขตข้อมูล **EnglishProductName** และ **ListPrice**

    ![บานหน้าต่างเขตข้อมูล](./media/service-gateway-sql-tutorial/fields-pane.png)

5. ลาก **วันที่สิ้นสุด** ลงบน**ตัวกรองระดับรายงาน**และภายใต้**การกรองพื้นฐาน** เลือกเฉพาะกล่องกาเครื่องหมายสำหรับ **(ว่าง)**

    ![ตัวกรองระดับรายงาน](./media/service-gateway-sql-tutorial/report-level-filters.png)

    ตอนนี้แผนภูมิควรมีลักษณะดังต่อไปนี้

    ![แผนภูมิคอลัมน์แบบสำเร็จ](./media/service-gateway-sql-tutorial/finished-column-chart.png)

    โปรดทราบว่าผลิตภัณฑ์ **Road-250** 5 รายการจะแสดงพร้อมด้วยรายการราคาสูงสุด ซึ่งจะเปลี่ยนแปลงเมื่อคุณอัปเดตข้อมูลและรีเฟรชรายงานในภายหลัง ในบทช่วยสอนนี้

6. บันทึกรายงานโดยใช้ชื่อ "AdventureWorksProducts.pbix"

7. บนแท็บ **หน้าแรก** ให้เลือก **เผยแพร่** \> **พื้นที่ทำงานของฉัน** \> **เลือก** ลงชื่อเข้าใช้ไปยังบริการของ Power BI ถ้าคุณถูกขอให้ทำเช่นนั้น

8. บนหน้าจอ **สำเร็จ** เลือก**เปิด 'TestGatewayDocs.pbix' ใน Power BI**

    [เผยแพร่ไปยัง Power BI](./media/service-gateway-sql-tutorial/publish-to-power-bi.png)

## <a name="connect-a-dataset-to-a-sql-server-database"></a>เชื่อมต่อชุดข้อมูลกับฐานข้อมูล SQL Server

ใน Power BI Desktop คุณได้เชื่อมต่อกับฐานข้อมูล SQL Server ภายในองค์กรของคุณโดยตรง แต่บริการของ Power BI ต้องใช้เกตเวย์ข้อมูลเพื่อทำหน้าที่เป็นสะพานเชื่อมระหว่างคลาวด์และเครือข่ายภายในองค์กรของคุณ ทำตามขั้นตอนเหล่านี้เพื่อเพิ่มฐานข้อมูล SQL Server ภายในองค์กรของคุณเป็นแหล่งข้อมูลในเกตเวย์ เชื่อมต่อชุดข้อมูลของคุณกับแหล่งข้อมูลนี้

1. ลงชื่อเข้าใช้ไปยัง Power BI ในมุมขวาบน เลือกไอคอนรูปเฟืองการตั้งค่า จากนั้นเลือก **การตั้งค่า**

    ![การตั้งค่า Power BI](./media/service-gateway-sql-tutorial/power-bi-settings.png)

2. บนการ**ชุดข้อมูล**แท็บ เลือกชุดข้อมูล**AdventureWorksProducts** ดังนั้นคุณสามารถเชื่อมต่อกับฐานข้อมูล SQL Server ภายในองค์กรของคุณผ่านเกตเวย์ข้อมูล

3. ขยาย**การเชื่อมต่อเกตเวย์**และตรวจสอบว่ามีอย่างน้อยหนึ่งเกตเวย์อยู่ในรายการ ถ้าคุณไม่มีเกตเวย์ ดูส่วน [ข้อกำหนดเบื้องต้น](#prerequisites) ก่อนหน้าในบทช่วยสอนนี้สำหรับลิงก์ไปยังเอกสารประกอบของผลิตภัณฑ์สำหรับการติดตั้งและการกำหนดค่าเกตเวย์

    ![การเชื่อมต่อเกตเวย์](./media/service-gateway-sql-tutorial/gateway-connection.png)

4. ภายใต้**การดำเนินการ** ขยายปุ่มสลับเพื่อดูแหล่งข้อมูล และเลือกลิงก์ **เพิ่มไปยังเกตเวย์**

    ![เพิ่มแหล่งข้อมูลไปยังเกตเวย์](./media/service-gateway-sql-tutorial/add-data-source-gateway.png)

    > [!NOTE]
    > ถ้าคุณไม่ได้เป็นผู้ดูแลระบบเกตเวย์ และไม่ต้องการติดตั้งเกตเวย์ด้วยตนเอง ติดต่อผู้ดูแลระบบเกตเวย์ในองค์กรของคุณ พวกเขาสามารถสร้างข้อกำหนดแหล่งข้อมูลที่จำเป็นต้องมีการเชื่อมต่อชุดข้อมูลของคุณลงในฐานข้อมูล SQL Server

5. บนหน้าการจัดการ**เกตเวย์** บนแท็บ**การตั้งค่าแหล่งข้อมูล** ใส่และตรวจสอบข้อมูลต่อไปนี้ แล้วเลือก**เพิ่ม**

    | ตัวเลือก | Value |
    | --- | --- |
    | ชื่อแหล่งข้อมูล | AdventureWorksProducts |
    | ชนิดแหล่งข้อมูล | เซิร์ฟเวอร์ SQL |
    | เซิร์ฟเวอร์ | ชื่อของอินสแตนซ์ SQL Server ของคุณ เช่น SQLServer01 (ต้องเหมือนกับสิ่งที่คุณได้ระบุไว้ใน Power BI Desktop) |
    | ฐานข้อมูล | ชื่อของฐานข้อมูล SQL Server ของคุณ เช่น AdventureWorksDW (ต้องเหมือนกับสิ่งที่คุณได้ระบุไว้ใน Power BI Desktop) |
    | วิธีการรับรองความถูกต้อง | Windows หรือพื้นฐาน (โดยทั่วไปแล้วคือ Windows) |
    | ชื่อผู้ใช้ | บัญชีที่คุณใช้เพื่อเชื่อมต่อกับ SQL Server |
    | รหัสผ่าน | รหัสผ่านสำหรับบัญชีที่คุณใช้เพื่อเชื่อมต่อกับ SQL Server |

    ![การตั้งค่าแหล่งข้อมูล](./media/service-gateway-sql-tutorial/data-source-settings.png)

6. บนแท็บ**ชุดข้อมูล** ขยายส่วน**การเชื่อมต่อเกตเวย์**อีกครั้ง เลือกเกตเวย์ข้อมูลที่คุณกำหนดค่า ซึ่งแสดง**สถานะ**ของการใช้งานบนเครื่องที่คุณติดตั้ง และเลือก**นำไปใช้**

    ![อัปเดตการเชื่อมต่อเกตเวย์](./media/service-gateway-sql-tutorial/update-gateway-connection.png)

## <a name="configure-a-refresh-schedule"></a>กำหนดตารางเวลาการรีเฟรช

ตอนนี้คุณได้เชื่อมต่อชุดข้อมูลใน Power BI กับฐานข้อมูล SQL Server ภายในองค์กรผ่านเกตเวย์ข้อมูล ทำตามขั้นตอนเหล่านี้เพื่อกำหนดตารางเวลาการรีเฟรช การรีเฟรชชุดข้อมูลตามกำหนดการช่วยให้แน่ใจว่ารายงานและแดชบอร์ดของคุณมีข้อมูลล่าสุด

1. ในบานหน้าต่างการนำทาง ให้เลือก **พื้นที่ทำงานของฉัน** \> **ชุดข้อมูล** เลือกจุดไข่ปลา ( **...** ) สำหรับชุดข้อมูล **AdventureWorksProducts**ชุดข้อมูล แล้วเลือก **กำหนดการรีเฟรช**

    > [!NOTE]
    > ให้แน่ใจว่าคุณเลือกจุดไข่ปลาสำหรับชุดข้อมูล **AdventureWorksProducts** และไม่ใช่จุดไข่ปลาสำหรับรายงานที่มีชื่อเดียวกัน เมนูบริบทของรายงาน **AdventureWorksProducts** ไม่รวมตัวเลือก **กำหนดการรีเฟรช**

2. ในส่วน **รีเฟรชตามกำหนดเวลา** ภายใต้**ปรับปรุงข้อมูลของคุณอยู่เสมอ** ตั้งค่ารีเฟรชเป็น**เปิด**

3. เลือก**ความถี่ในการรีเฟรช**ที่เหมาะสม (**ทุกวัน**สำหรับตัวอย่างนี้), จากนั้นภายใต้**เวลา** ให้เลือก**เพิ่มเวลาอื่น**เมื่อต้องระบุเวลาการรีเฟรชที่ต้องการ (6:30 AM และ PM ตัวอย่างนี้)

    ![กำหนดค่าการรีเฟรชตามกำหนดการ](./media/service-gateway-sql-tutorial/configure-scheduled-refresh.png)

    > [!NOTE]
    > คุณสามารถกำหนดค่าช่วงเวลาการรีเฟรชสูงสุด 8 ครั้งต่อวันหากชุดข้อมูลของคุณอยู่ในความจุที่ใช้ร่วมกันหรือ 48 ครั้งต่อวันสำหรับ Power BI Premium

4. ยกเลิกการเปิดใช้งานกล่องกาเครื่องหมาย **ส่งอีเมลแจ้งเตือนความล้มเหลวในการรีเฟรชถึงฉัน** และเลือก **นำไปใช้**

## <a name="perform-an-on-demand-refresh"></a>ดำเนินการรีเฟรชตามความต้องการ

หลังจากที่คุณได้กำหนดตารางเวลาการรีเฟรชแล้ว Power BI จะรีเฟรชชุดข้อมูลของคุณในเวลาที่กำหนดไว้ถัดไปภายในช่วงระยะเวลา 15 นาที หากคุณต้องการรีเฟรชข้อมูลเร็วขึ้นเช่น เพื่อทดสอบเกตเวย์และการกำหนดค่าแหล่งข้อมูลของคุณ ให้ทำการรีเฟรชตามคำขอโดยใช้ตัวเลือก **รีเฟรชเดี๋ยวนี้** ในเมนูชุดข้อมูลในบานหน้าต่างนำทาง การรีเฟรชตามความต้องการไม่มีผลต่อเวลาการรีเฟรชตามกำหนดเวลาช่วงถัดไป แต่จะนับรวมขีดจำกัดการรีเฟรชประจำวันตามที่อธิบายไว้ในบทความก่อนหน้านี้

สำหรับวัตถุประสงค์ จำลองการเปลี่ยนแปลงในข้อมูลตัวอย่างโดยการอัปเดตตาราง DimProduct ในฐานข้อมูล AdventureWorksDW ที่ใช้ SQL Server Management Studio (SSMS)

```sql

UPDATE [AdventureWorksDW].[dbo].[DimProduct]
SET ListPrice = 5000
WHERE EnglishProductName ='Road-250 Red, 58'

```

ตอนนี้ทำตามขั้นตอนเหล่านี้เพื่อให้ข้อมูลที่อัปเดตสามารถไหลผ่านการเชื่อมต่อเกตเวย์ไปยังชุดข้อมูลและเข้าไปยังรายงานใน Power BI

1. ในการบริการของ Power BI ในบานหน้าต่างนำทาง ให้เลือกและขยาย **พื้นที่ทำงานของฉัน**

2. ภายใต้**ชุดข้อมูล** สำหรับชุดข้อมูล **AdventureWorksProducts** เลือกจุดไข่ปลา ( **...** ) แล้ว เลือก**รีเฟรชเดี๋ยวนี้**

    ![รีเฟรชเดี๋ยวนี้](./media/service-gateway-sql-tutorial/refresh-now.png)

    บันทึกย่อในมุมบนขวา ว่า Power BI ่กำลังเตรียมดำเนินการรีเฟรชที่ร้องขอ

3. เลือก **พื้นที่ทำงานของฉัน\> รายงาน\> AdventureWorksProducts** ดูวิธีการที่ข้อมูลที่อัปเดตแล้วไหลผ่าน และผลิตภัณฑ์ที่มีรายการราคาสูงสุดตอนนี้คือ **Road-250 Red, 58**

    ![แผนภูมิคอลัมน์ที่อัปเดตแล้ว](./media/service-gateway-sql-tutorial/updated-column-chart.png)

## <a name="review-the-refresh-history"></a>ตรวจสอบประวัติการรีเฟรช

ควรตรวจสอบผลลัพธ์ของรอบการรีเฟรชผ่านมาเป็นระยะ ๆ ในประวัติการรีเฟรช ข้อมูลประจำตัวของฐานข้อมูลอาจหมดอายุแล้ว หรือเกตเวย์ที่เลือกอาจมีอยู่ในสถานะออฟไลน์เมื่อครบกำหนดการรีเฟรชตามกำหนดเวลา ทำตามขั้นตอนเหล่านี้เพื่อตรวจสอบประวัติการรีเฟรชและตรวจหาปัญหา

1. ในมุมขวาบนของอินเทอร์เฟสผู้ใช้ Power BI เลือกไอคอนรูปเฟืองการตั้งค่า จากนั้นเลือก **การตั้งค่า**

2. สลับไปยัง**ชุดข้อมูล**และเลือกชุดข้อมูล เช่น **AdventureWorksProducts** หากคุณต้องการตรวจสอบ

3. เลือกลิงก์ **ประวัติการรีเฟรช** เพื่อเปิดกล่องโต้ตอบ **ประวัติการรีเฟรช**

    ![ลิงก์ประวัติการรีเฟรช](./media/service-gateway-sql-tutorial/refresh-history-link.png)

4. บนแท็บ**ตามกำหนดเวลา** สังเกตการรีเฟรชตามกำหนดเวลาและตามความต้องการด้วยเวลา**เริ่มต้น**และ**สิ้นสุด** และ**สถานะ**ที่**เสร็จสมบูรณ์** ซึ่งระบุว่า Power BI ได้ดำเนินการรีเฟรชเรียบร้อยแล้ว สำหรับการรีเฟรชล้มเหลว คุณสามารถดูข้อความแสดงข้อผิดพลาด และตรวจสอบรายละเอียดข้อผิดพลาด

    ![รายละเอียดประวัติการรีเฟรช](./media/service-gateway-sql-tutorial/refresh-history-details.png)

    > [!NOTE]
    > แท็บ OneDrive จะเกี่ยวข้องกับชุดข้อมูลที่เชื่อมต่อกับไฟล์ Power BI Desktop เวิร์กบุ๊ก Excel หรือไฟล์ CSV ใน OneDrive หรือ SharePoint Online ตามที่อธิบายไว้ในรายละเอียดเพิ่มเติมใน [รีเฟรชข้อมูลใน Power BI](refresh-data.md)

## <a name="clean-up-resources"></a>เพิ่มพื้นที่ทรัพยากร

ถ้าคุณไม่ต้องการใช้ข้อมูลตัวอย่างอีกต่อไป วางฐานข้อมูลใน SQL Server Management Studio (SSMS) ถ้าคุณไม่ต้องการใช้แหล่งข้อมูล SQL Server ให้ลบแหล่งข้อมูลออกจากเกตเวย์ข้อมูลของคุณ นอกจากนี้ ให้พิจารณาถอนการติดตั้งเกตเวย์ข้อมูลถ้าคุณเพียงแค่ติดตั้งไว้เพื่อวัตถุประสงค์ในการทำให้บทช่วยสอนนี้สมบูรณ์ คุณยังควรลบชุดข้อมูล AdventureWorksProducts และรายงาน AdventureWorksProducts ที่ Power BI สร้างขึ้นเมื่อคุณอัปโหลดไฟล์ AdventureWorksProducts.pbix

## <a name="next-steps"></a>ขั้นตอนถัดไป

ในบทช่วยสอนนี้ คุณได้สำรวจวิธีการนำเข้าข้อมูลจากฐานข้อมูล SQL Server ภายในองค์กรไปยังชุดข้อมูล Power BI และวิธีการรีเฟรชชุดข้อมูลนี้ตามกำหนดเวลาและตามความต้องการ เพื่อเก็บรายงานและแดชบอร์ดที่ใช้ชุดข้อมูลนี้ที่อัปเดตใน Power BI ตอนนี้ คุณสามารถเรียนรู้เพิ่มเติมเกี่ยวกับการจัดการเกตเวย์ข้อมูลและแหล่งข้อมูลใน Power BI นอกจากนี้ คุณยังควรตรวจสอบการรีเฟรชข้อมูลบทความเชิงแนวคิดใน Power BI

- [จัดการเกตเวย์ข้อมูลภายในองค์กร](/data-integration/gateway/service-gateway-manage)
- [จัดการแหล่งข้อมูลของคุณ - นำเข้า/รีเฟรชตามกำหนดการ](service-gateway-enterprise-manage-scheduled-refresh.md)
- [การรีเฟรชข้อมูลใน Power BI](refresh-data.md)
