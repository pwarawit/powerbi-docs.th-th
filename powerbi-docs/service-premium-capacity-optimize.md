---
title: Microsoft Power BI Premium ความจุที่ปรับให้เหมาะสม
description: อธิบายวิธีการปรับให้เหมาะสมสำหรับความจุ Power BI Premium
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 04/09/2019
ms.custom: seodec18
LocalizationGroup: Premium
ms.openlocfilehash: 06712b6bcf57ca84ec03d2c7b99b32ea61ad8c71
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: th-TH
ms.lasthandoff: 05/29/2019
ms.locfileid: "65565337"
---
# <a name="optimizing-premium-capacities"></a>ความจุ Premium ที่ปรับให้เหมาะสม

เมื่อเกิดปัญหาด้านประสิทธิภาพความจุ Premium วิธีแรกแบบทั่วไปคือการ ปรับให้เหมาะสม หรือปรับแต่งโซลูชันของคุณเพื่อคืนค่าเวลาในการตอบกลับที่ยอมรับได้ Rationale เพื่อหลีกเลี่ยงการซื้อเพิ่มเติมความจุ Premium เว้นแต่ว่าชิดขอบ

เมื่อจำเป็นต้องเพิ่มเติมความจุ Premium มีสองตัวเลือกที่อธิบายไว้ในบทความนี้:

- สเกลค่าความจุ Premium ที่มีอยู่
- เพิ่มความจุแบบพรีเมียมใหม่

สุดท้าย ทดสอบวิธีและปรับขนาดความจุ Premium ทรานบทความนี้

## <a name="best-practices"></a>แนวทางปฏิบัติที่ดีที่สุด

เมื่อพยายามเรียกใช้ประโยชน์และประสิทธิภาพการทำงานที่ดีที่สุด มีบางแนะนำแนวทางปฏิบัติ รวมถึง:

- ใช้พื้นที่ทำงานแอแทนพื้นที่ทำงานส่วนบุคคล
- แยกทางธุรกิจที่สำคัญและ BI Self-Service (SSBI) ลงในความจุอื่น

  ![การแยกความสำคัญทางธุรกิจและ Self-Service BI ลงในความจุอื่น](media/service-premium-capacity-optimize/separate-capacities.png)

- ถ้าการแชร์เนื้อหากับผู้ใช้ Power BI Pro เท่านั้น อาจไม่จำเป็นต้องจัดเก็บเนื้อหาในความจุเฉพาะ
- ใช้ความจุเฉพาะ เมื่อต้องการให้ได้เวลารีเฟรชเฉพาะ หรือ เมื่อจำเป็นต้องมีคุณลักษณะเฉพาะ ตัวอย่าง ด้วยชุดข้อมูลขนาดใหญ่หรือรายงานมีการแบ่งหน้า

### <a name="addressing-common-questions"></a>กำหนดคำถามทั่วไป

ปรับใช้ Power BI Premium ที่ปรับให้เหมาะสมเป็นเรื่องซับซ้อนเกี่ยวข้องกับการทำความเข้าใจความต้องการของปริมาณงาน ทรัพยากรพร้อมใช้งาน และมีผลบังคับใช้

บทความนี้อยู่เจ็ดสนับสนุนคำถามทั่วไป อธิบายปัญหาที่เป็นไปได้ และคำอธิบาย และข้อมูลเกี่ยวกับวิธีการระบุ และแก้ไขปัญหาเหล่านี้

### <a name="why-is-the-capacity-slow-and-what-can-i-do"></a>ทำไมความจุจึงช้าลง และฉันสามารถทำอะไรได้บ้าง

มีหลายเหตุผลที่สามารถทำให้ความจุแบบพรีเมียมช้าลง คำถามนี้ต้องการข้อมูลเพิ่มเติมเพื่อทำความเข้าใจกับสิ่งที่ทำให้ช้าลง รายงานโหลดช้าหรือไม่ หรือไม่สามารถโหลดรายงานได้ใช่หรือไม่ วิชวลการรายงานโหลดช้าหรืออัปเดตเมื่อผู้ใช้โต้ตอบกับรายงานใช่หรือไม่ จะรีเฟรชใช้เวลานานกว่าในการทำให้เสร็จสมบูรณ์เกินกว่าที่คาดไว้ หรือก่อนหน้านี้ พบใช่หรือไม่

เมื่อเข้าใจเหตุผลแล้ว คุณสามารถเริ่มตรวจสอบได้ คำตอบสำหรับคำถามหกข้อต่อไปนี้จะช่วยให้คุณสามารถแก้ไขปัญหาที่เฉพาะเจาะจงได้มากขึ้น

### <a name="what-content-is-using-up-my-capacity"></a>เนื้อหาใดที่ใช้ความจุของฉันหมด

คุณสามารถใช้แอป**เมตริกความจุ Power BI Premium**เพื่อกรองตามความจุ และตรวจสอบเมตริกประสิทธิภาพการทำงานสำหรับเนื้อหาของพื้นที่ทำงานได้ จำเป็นต้องตรวจสอบการใช้งานเมตริกและทรัพยากรของประสิทธิภาพการทำงาน โดยชั่วโมงสำหรับ 7 วันผ่านมาสำหรับเนื้อหาทั้งหมดที่จัดเก็บไว้ภายในความจุ Premium ตรวจสอบมักขั้นตอนแรกจะดำเนินการเมื่อการแก้ไขปัญหาข้อกังวลทั่วไปเกี่ยวกับประสิทธิภาพการทำงานความจุ Premium

เมตริกหลักที่จะต้องตรวจสอบรวมถึง:

- ค่าเฉลี่ย CPU และใช้ประโยชน์สูงจำนวน
- เฉลี่ยหน่วยความจำ และใช้ประโยชน์สูง count และใช้หน่วยความจำสำหรับชุดข้อมูลที่เฉพาะเจาะจง dataflows และรายงานแบบแบ่งหน้า
- โหลดชุดข้อมูลที่ใช้งานอยู่ในหน่วยความจำ
- ระยะเวลาเฉลี่ย และสูงสุดแบบสอบถาม
- เวลารอคิวโดยเฉลี่ย
- ชุดข้อมูลโดยเฉลี่ยและ dataflow รีเฟรชครั้ง

ในแอป Power BI Premium ความจุเมตริก หน่วยความจำที่ใช้งานอยู่แสดงจำนวนรวมของหน่วยความจำที่มอบให้กับรายงานที่ไม่สามารถเอาออกได้เนื่องจากถูกใช้ภายในสามนาทีล่าสุด อัตราการเพิ่มขึ้นสูงในระยะเวลารอการรีเฟรชอาจมีความสัมพันธ์กับชุดข้อมูลขนาดใหญ่และ/หรือชุดข้อมูลที่ใช้งานอยู่

การ**5 อันดับแรกตามระยะเวลาเฉลี่ย**แผนภูมิเน้นชุดข้อมูลด้านบนสุดห้า รายงานแบบแบ่งหน้า และใช้ทรัพยากรความจุ dataflows เนื้อหาในด้านบนสุดห้ารายการเป็นตัวเลือกสำหรับการตรวจสอบและสามารถปรับให้เหมาะสม

### <a name="why-are-reports-slow"></a>ทำไมรายงานจึงช้า

ตารางต่อไปนี้แสดงปัญหาที่เป็นไปได้และวิธีการระบุและแก้ไขปัญหาเหล่านั้น

#### <a name="insufficient-capacity-resources"></a>ทรัพยากรความจุไม่เพียงพอ

| คำอธิบายที่เป็นไปได้ | วิธีการระบุ | วิธีการแก้ไข |
| --- | --- | --- |
| หน่วยความจำที่ใช้งานที่รวมสูง (แบบจำลองไม่สามารถเอาออกได้เนื่องจากมีการใช้งานภายในสามนาทีล่าสุด) ได้<br><br> หลาย spikes สูงในแบบสอบถามรอครั้ง<br><br> หลาย spikes สูงในการรีเฟรชรอครั้ง | ตรวจสอบเมทริกซ์หน่วยความจำ\[ [1](#endnote-1)\]และจำนวน eviction \[ [2](#endnote-2)\] | ลดขนาดแบบจำลอง หรือแปลงเป็นโหมด DirectQuery ดู[โมเดลที่ปรับให้เหมาะสม](#optimizing-models)ส่วนในบทความนี้<br><br> สเกลค่ากำลังการผลิต<br><br> กำหนดเนื้อหาให้ความจุอื่น |

#### <a name="inefficient-report-designs"></a>การออกแบบรายงานที่ไม่มีประสิทธิภาพ

| คำอธิบายที่เป็นไปได้ | วิธีการระบุ | วิธีการแก้ไข |
| --- | --- | --- |
| หน้ารายงานประกอบด้วยภาพมากเกินไป (กรองแบบโต้ตอบสามารถทริกเกอร์อย่างน้อยหนึ่งคิวรีต่อวิชวล)<br><br> ภาพดึงข้อมูลที่มากกว่าที่จำเป็น | ตรวจสอบการออกแบบรายงาน<br><br> สัมภาษณ์ผู้ใช้รายงานเพื่อทำความเข้าใจว่าพวกเขาโต้ตอบกับรายงาน<br><br> ตรวจสอบชุดข้อมูลแบบสอบถามเมตริก\[ [3](#endnote-3)\] | รายงานกครั้ง ด้วยวิชวลที่น้อยลงสำหรับแต่ละหน้า |

#### <a name="dataset-is-slow-especially-when-reports-have-previously-performed-well"></a>ชุดข้อมูลช้า โดยเฉพาะอย่างยิ่งเมื่อทำรายงานก่อนหน้านี้ด้วย

| คำอธิบายที่เป็นไปได้ | วิธีการระบุ | วิธีการแก้ไข |
| --- | --- | --- |
| เพิ่มขึ้นเรื่อย ๆ นำเข้าข้อมูลจำนวนมาก<br><br> ตรรกะการคำนวณที่ซับซ้อน หรือต่ำ รวมถึงบทบาท RLS<br><br> แบบจำลองที่ปรับให้เหมาะสมได้<br><br> (DQ/LC) เวลาแฝงเกตเวย์<br><br> ช้า DQ แหล่งแบบสอบถามเวลาในการตอบกลับ | ตรวจสอบการออกแบบแบบจำลอง<br><br> ตรวจสอบตัวนับประสิทธิภาพการทำงานเกตเวย์ | ดู[โมเดลที่ปรับให้เหมาะสม](#optimizing-models)ส่วนในบทความนี้ |

#### <a name="high-concurrent-report-usage"></a>การใช้รายงานพร้อมกันสูง

| คำอธิบายที่เป็นไปได้ | วิธีการระบุ | วิธีการแก้ไข |
| --- | --- | --- |
| เวลารอคิวรีสูง<br><br> ความเข้มของ CPU<br><br> จำกัดการเชื่อมต่อ DQ/LC เกิน | ตรวจสอบการใช้งาน CPU \[ [4](#endnote-4)\]เวลารอคิวรี และใช้ประโยชน์ DQ/LC \[ [5](#endnote-5) \]เมตริก + ระยะเวลาแบบสอบถาม ถ้าขึ้น ๆ ลง ๆ สามารถระบุปัญหาที่เกิดซ้ำ | ค่าความจุสเกล หรือกำหนดเนื้อหาเป็นความจุอื่น<br><br> รายงานกครั้ง ด้วยวิชวลที่น้อยลงสำหรับแต่ละหน้า |

**บันทึกย่อ:**    
<a name="endnote-1"></a>\[1\]โดยเฉลี่ยใช้หน่วยความจำ (GB), และปริมาณการใช้หน่วยความจำสูงสุด (GB)   
<a name="endnote-2"></a>\[2\]จัดชุดข้อมูล   
<a name="endnote-3"></a>\[3\]ชุดข้อมูลแบบสอบถาม ระยะเวลาแบบสอบถามชุดข้อมูลค่าเฉลี่ย (ms), ชุดข้อมูลรอ Count และค่าเฉลี่ยของชุดข้อมูลเวลารอ (ms)   
<a name="endnote-4"></a>\[4\] Count ใช้ประโยชน์สูง CPU และเวลาของ CPU การใช้งานสูงสุด (ช่วงเจ็ดวัน)   
<a name="endnote-5"></a>\[5\] DQ/LC Count ใช้ประโยชน์สูงและ DQ/LC เวลาของการใช้ประโยชน์สูงสุด (ช่วงเจ็ดวัน)   

### <a name="why-are-reports-not-loading"></a>เหตุใดรายงานจึงไม่โหลด

เมื่อรายงานไม่สามารถโหลด เป็นเครื่องหมายแน่ใจว่ากำลังการผลิตที่มีหน่วยความจำไม่เพียงพอ และเป็นเครื่องทำความร้อนมากเกินไป สิ่งนี้สามารถเกิดขึ้นได้เมื่อแบบจำลองที่โหลดทั้งหมดกำลังถูกคิวรีอย่างแข็งขันและไม่สามารถลบออกไล่ได ้และการดำเนินการรีเฟรชใด ๆ ได้ถูกหยุดชั่วคราวหรือล่าช้า บริการของ Power BI จะพยายามโหลดชุดข้อมูลเป็น 30 วินาที และผู้ใช้ได้รับแจ้งเตือนอย่างสุภาพถึงความล้มเหลว พร้อมด้วยคำแนะนำให้ลองอีกครั้งในอีกสักครู่

ในขณะนี้ ไม่มีเมตริกสำหรับตรวจสอบความล้มเหลวในการโหลดรายงาน คุณสามารถระบุความเป็นไปได้ของปัญหานี้ได้โดยการตรวจสอบหน่วยความจำระบบ โดยเฉพาะการใช้งานสูงสุดและเวลาที่มีการใช้งานสูงสุด การลดสัดส่วนชุดข้อมูลสูงและเวลารอเฉลี่ยในการรีเฟรชชุดข้อมูลที่นานแสดงว่าปัญหานี้กำลังเกิดขึ้น

หากเหตุการณ์เกิดขึ้นเพียงแค่นาน ๆ ครั้ง อาจไม่ถือว่าเป็นปัญหาที่มีความสำคัญ ผู้ใช้รายงานจะได้รับแจ้งว่าบริการไม่ว่างและควรลองอีกครั้งหลังจากนั้นสักครู่ หากเหตุการณ์นี้เกิดขึ้นบ่อยเกินไป ปัญหาสามารถแก้ไขได้ด้วยการเพิ่มขนาดความจุแบบพรีเมียมหรือโดยการกำหนดเนื้อหาไปยังความจุอื่น

ผู้ดูแลระบบความจุ (และผู้ดูแลระบบบริการของ Power BI) สามารถตรวจสอบเมตริก**ความล้มเหลวของคิวรี**เพื่อกำหนดช่วงเวลาที่เหตุการณ์นี้จะเกิดขึ้น นอกจากนี้ พวกเขายังสามารถรีสตาร์ทความจุ โดยการรีเซ็ตการทำงานทั้งหมดในกรณีที่ระบบโอเวอร์โหลด

### <a name="why-are-refreshes-not-starting-on-schedule"></a>ทำไมการรีเฟรชจึงไม่เริ่มต้นตามกำหนดเวลา

ไม่รับประกันเวลาเริ่มต้นการรีเฟรชตามกำหนดเวลา โปรดทราบว่าบริการของ Power BI จะจัดลำดับความสำคัญของการทำงานแบบโต้ตอบเหนือกว่าการทำงานแบบเบื้องหลังเสมอ การรีเฟรชเป็นการทำงานแบบเบื้องหลังที่สามารถเกิดขึ้นเมื่อตรงตามเงื่อนไขสองประการได้แก่:

- มีหน่วยความจำเพียงพอ
- ไม่เกินจำนวนการรีเฟรชที่เกิดขึ้นพร้อมกันที่ความจุแบบพรีเมียมรองรับ

เมื่อไม่ตรงตามเงื่อนไข การรีเฟรชจะถูกจัดคิวไว้จนกว่าเงื่อนไขจะมีผล

สำหรับการรีเฟรชเต็มรูปแบบ โปรดทราบว่าต้องมีขนาดหน่วยความจำของชุดข้อมูลปัจจุบันอย่างน้อยสองเท่า หากหน่วยความจำไม่เพียงพอ การรีเฟรชไม่สามารถเริ่มได้จนกว่าการลดสัดส่วนแบบจำลองจะทำให้หน่วยความจำว่าง นั่นหมายถึงความล่าช้าจนกว่าชุดข้อมูลตั้งแต่หนึ่งชุดขึ้นไปจะไม่ทำงานและสามารถลบออกได้

โปรดทราบว่าจำนวนการรีเฟรชที่เกิดขึ้นพร้อมกันสูงสุดที่รองรับถูกตั้งไว้ที่ 1.5 เท่าของวี-คอร์ Backend โดยปัดเศษขึ้น

การรีเฟรชตามกำหนดเวลาจะล้มเหลวเมื่อไม่สามารถเริ่มได้ก่อนที่การรีเฟรชตามกำหนดเวลาครั้งต่อไปจะเกิดขึ้น การรีเฟรชตามความต้องการที่ทริกเกอร์ด้วยตนเองจาก UI จะพยายามเรียกใช้งานได้ถึงสามครั้งก่อนที่จะล้มเหลว

ผู้ดูแลระบบของความจุ (และผู้ดูแลระบบบริการของ Power BI) สามารถตรวจสอบเมตริก**เวลารอรีเฟรชโดยเฉลี่ย (นาที)** เพื่อกำหนดว่าการหน่วงเวลาเฉลี่ยระหว่างเวลาที่กำหนดไว้และจุดเริ่มต้นของการดำเนินการ

แม้ว่าโดยปกติจะไม่ให้ความสำคัญกับการดูแลระบบเพื่อให้มีผลต่อการรีเฟรชข้อมูลตรงเวลา แต่ต้องให้แน่ใจว่ามีหน่วยความจำเพียงพอ ซึ่งอาจเกี่ยวข้องกับการแยกชุดข้อมูลกับความจุที่มีทรัพยากรเพียงพอที่เป็นที่รู้จัก จะเป็นไปได้ว่า ผู้ดูแลระบบสามารถเข้ากับเจ้าของชุดข้อมูลเพื่อช่วยจัดสลับ หรือลดเวลาการรีเฟรชข้อมูลตามกำหนดเวลาเพื่อลดชน โปรดทราบว่า ไม่เป็นไปได้สำหรับผู้ดูแลระบบเมื่อ ต้องดูคิวรีเฟรช หรือเรียกใช้กำหนดการชุดข้อมูล

### <a name="why-are-refreshes-slow"></a>ทำไมการรีเฟรชจึงช้า

การรีเฟรชอาจช้าหรือรับรู้ได้ว่าจะช้า (ตามที่กล่าวถึงในคำถามทั่วไปก่อนหน้านี้)

เมื่อการรีเฟรชช้าลง อาจเป็นเพราะสาเหตุหลายประการ:

- CPU ไม่เพียงพอ (รีเฟรชไม่มาก CPU สูง) ได้
- ไม่เพียงพอหน่วยความจำ เกิดรีเฟรชหยุดชั่วคราว (ซึ่งจำเป็นต้องรีเฟรชเพื่อเริ่มต้นใหม่เมื่อเงื่อนไขเป็นผล recommence)
- เหตุผลความจุที่ไม่ใช่ รวมถึงการตอบสนองระบบแหล่งข้อมูล เวลาแฝงเครือข่าย สิทธิ์ที่ไม่ถูกต้อง หรือปริมาณงานเกตเวย์
- ปริมาณข้อมูล - เหตุผลเหมาะสมเพื่อกำหนดค่าการรีเฟรช ตามที่อธิบายไว้ด้านล่าง

ผู้ดูแลระบบความจุ (และผู้ดูแลระบบบริการของ Power BI) สามารถตรวจสอบเมตริก **ระยะเวลาการรีเฟรชโดยเฉลี่ย (นาที)** เพื่อกำหนดเกณฑ์มาตรฐานสำหรับการเปรียบเทียบเมื่อเวลาผ่านไปและเมตริก **เวลารอรีเฟรชโดยเฉลี่ย (นาที)** เพื่อกำหนดการหน่วงเวลาเฉลี่ยระหว่างเวลาที่กำหนดไว้และจุดเริ่มต้นของการดำเนินการ

การรีเฟรชแบบเพิ่มทีละส่วนสามารถลดระยะเวลาการรีเฟรชข้อมูลได้อย่างมาก โดยเฉพาะอย่างยิ่งสำหรับตารางแบบจำลองขนาดใหญ่ มีข้อดีสี่ประการที่เกี่ยวข้องกันการรีเฟรชแบบเพิ่มทีละส่วนได้แก่:

- **การรีเฟรชเร็วกว่า**- เฉพาะชุดย่อยของตารางจำเป็นต้องใช้ CPU และหน่วยความจำที่ลดลง การโหลดงาน และขนานอาจสูงกว่าเมื่อรีเฟรชหลายพาร์ติชัน
- **รีเฟรชเกิดขึ้นเฉพาะเมื่อจำเป็น**-สามารถกำหนดค่านโยบายการรีเฟรชแบบเพิ่มหน่วยจะโหลดเฉพาะ เมื่อข้อมูลมีการเปลี่ยนแปลงได้
- **รีเฟรชที่มีประสิทธิภาพมาก**-สั้นกว่าการเชื่อมต่อทำงานกับระบบแหล่งข้อมูลที่เปลี่ยนแปลงได้จะน้อยควบคู่ disconnection
- **แบบจำลองยังคง trim** -สามารถกำหนดค่านโยบายการรีเฟรชแบบเพิ่มหน่วยการลบประวัตินอกเหนือจากแถบเลื่อนหน้าต่างเวลาโดยอัตโนมัติได้

เมื่อต้องการเรียนรู้เพิ่มเติม ดู[รีเฟรชแบบเพิ่มหน่วยใน Power BI Premium](service-premium-incremental-refresh.md)

### <a name="why-are-data-refreshes-not-completing"></a>ทำไมการรีเฟรชข้อมูลจึงไม่เสร็จสมบูรณ์

เมื่อการรีเฟรชข้อมูลเริ่มขึ้นแต่ไม่สำเร็จ อาจเป็นเพราะสาเหตุหลายประการ:

- หน่วยความจำไม่เพียงพอ แม้ว่ามีเพียงหนึ่งโมเดลในความจุ Premium เช่นขนาดแบบจำลองมีขนาดใหญ่มาก
- เหตุผลความจุที่ไม่ใช่ รวมถึงแหล่งข้อมูลระบบ disconnection สิทธิ์ที่ไม่ถูกต้อง หรือข้อผิดพลาดเกตเวย์

ผู้ดูแลระบบความจุ (และผู้ดูแลระบบบริการของ Power BI) สามารถตรวจสอบเมตริก**การรีเฟรชล้มเหลวเนื่องจากหน่วยความจำไม่เพียงพอ**

## <a name="optimizing-models"></a>แบบจำลองที่ปรับให้เหมาะสม

การออกแบบแบบจำลองที่เหมาะสมเป็นสิ่งสำคัญอย่างยิ่งในการส่งต่อโซลูชันที่มีประสิทธิภาพและปรับขนาดได้ อย่างไรก็ตาม ได้เกินขอบเขตของบทความนี้เพื่อให้การสนทนาทั้งหมด แต่ในส่วนนี้จะมีประเด็นสำคัญสำหรับการพิจารณาเมื่อทำการปรับแบบจำลองให้เหมาะสม

### <a name="optimizing-power-bi-hosted-models"></a>Power BI ดประสิทธิภาพโฮสต์แบบจำลอง

แบบจำลองที่โฮสต์ในความจุ Premium ที่ปรับให้เหมาะสมสามารถทำได้ในเลเยอร์ datasource(s) และแบบจำลอง

พิจารณาความเป็นไปได้ในการปรับให้เหมาะสมที่สุดสำหรับแบบจำลองการนำเข้า:

![ความเป็นไปได้ในการปรับให้เหมาะสมที่สุดสำหรับแบบจำลองการนำเข้า:](media/service-premium-capacity-optimize/import-model-optimizations.png)

ในเลเยอร์แหล่งข้อมูล:

- แหล่งข้อมูลเชิงสัมพันธ์สามารถถูกปรับให้เหมาะสมเพื่อให้แน่ใจว่าการรีเฟรชเป็นไปได้เร็วที่สุด โดยรวมไว้ล่วงหน้าข้อมูล ใช้ดัชนีที่เหมาะสม กำหนดพาร์ติชันตารางที่จัดชิดกับรอบระยะเวลาการรีเฟรชแบบเพิ่มหน่วย และแสดงการคำนวณ (แทนที่คำนวณ รูปแบบตารางและคอลัมน์) หรือเพิ่มตรรกะการคำนวณลงในมุมมอง
- แหล่งข้อมูลเชิงสัมพันธ์ไม่สามารถถูกรวมเข้ากับร้านค้าเชิงสัมพันธ์ไว้ล่วงหน้า
- ให้แน่ใจว่า เกตเวย์มีทรัพยากรเพียงพอ อาจเป็นบนเครื่องเฉพาะ มีแบนด์วิดธ์เครือข่ายเพียงพอ และ ในความใกล้เคียงปิดแหล่งข้อมูล

ในเลเยอร์แบบจำลอง:

- การออกแบบคิวรี Power Query สามารถลดหรือลบการแปลงข้อมูลที่ซับซ้อนและโดยเฉพาะอย่างยิ่งที่รวมแหล่งข้อมูลที่แตกต่างกัน (คลังข้อมูลสามารถดำเนินการตามขั้นตอนนี้ได้ในช่วง Extract-Transform-Load) ยัง แน่ใจว่าแหล่งข้อมูลที่เหมาะสมระดับความเป็นส่วนตัวจะถูกตั้งค่า ซึ่งสามารถหลีกเลี่ยง Power BI เพื่อโหลดผลลัพธ์ทั้งหมดเพื่อสร้างผลลัพธ์รวมทั้งแบบสอบถาม
- โครงสร้างแบบจำลองจะกำหนดข้อมูลที่จะโหลดและมีผลกระทบโดยตรงต่อขนาดของแบบจำลอง ซึ่งสามารถออกแบบมาเพื่อหลีกเลี่ยงการโหลดข้อมูลที่ไม่จำเป็นโดยการลบคอลัมน์ การลบแถว (โดยเฉพาะข้อมูลประวัติ) หรือโดยการโหลดข้อมูลสรุป (มีค่าใช้จ่ายในการโหลดข้อมูลรายละเอียด) การลดขนาดแบบพิเศษสามารถทำได้โดยการลบคอลัมน์ที่มีคาร์ดินาลลิตี้สูง (โดยเฉพาะคอลัมน์ข้อความ) ซึ่งไม่ได้จัดเก็บหรือบีบอัดอย่างมีประสิทธิภาพ
- สามารถปรับปรุงประสิทธิภาพของการคิวรีแบบจำลองได้โดยการกำหนดค่าความสัมพันธ์ทิศทางเดียว เว้นแต่ว่ามีเหตุผลที่น่าสนใจเพื่อให้สามารถกรองแบบสองทิศทางได้ พิจารณาใช้[CROSSFILTER](https://docs.microsoft.com/dax/crossfilter-function)ฟังก์ชันแทนที่จะกรองสองทิศทาง
- ตารางการรวมสามารถตอบสนองการคิวรีได้อย่างรวดเร็วโดยการโหลดข้อมูลที่สรุปไว้ล่วงหน้า อย่างไรก็ตามการดำเนินการนี้จะเพิ่มขนาดของแบบจำลองและส่งผลให้เวลาการรีเฟรชนานขึ้น โดยทั่วไป ตารางการรวมควรสำรองไว้สำหรับแบบจำลองที่มีขนาดใหญ่มากหรือการออกแบบแบบจำลองรวม
- ตารางและคอลัมน์จากการคำนวณจะเพิ่มขนาดของแบบจำลอง และทำให้เวลาการรีเฟรชนานขึ้น โดยทั่วไปแล้ว เก็บข้อมูลขนาดเล็กและเวลารีเฟรชที่รวดเร็วสามารถทำได้เมื่อข้อมูลจะเป็นจริง หรือคำนวณในแหล่งข้อมูล หากไม่สามารถทำได้ การใช้คอลัมน์ที่กำหนดเองของ Power Query สามารถนำเสนอการบีบอัดที่เก็บข้อมูลที่ดีขึ้น
- อาจมีโอกาสในการปรับแต่งนิพจน์ DAX สำหรับหน่วยวัดและกฎ RLS ซึ่งอาจเขียนตรรกะใหม่เพื่อหลีกเลี่ยงสูตรราคาแพง
- การรีเฟรชแบบเพิ่มทีละส่วนสามารถลดเวลาการรีเฟรชได้อย่างมาก รวมถึงประหยัดหน่วยความจำและ CPU การรีเฟรชแบบเพิ่มทีละส่วนยังสามารถกำหนดค่าเพื่อลบข้อมูลประวัติที่มีข้อมูลการปรับแต่งขนาดของแบบจำลอง
- แบบจำลองไม่สามารถออกแบบใหม่เป็นสองแบบจำลองที่มีรูปแบบการคิวรีต่างกันและขัดแย้งกัน ตัวอย่างเช่น รายงานบางฉบับจะแสดงการรวมระดับสูงในทุก ๆ ประวัติและสามารถยอมรับเวลาแฝงใน 24 ชั่วโมง รายงานอื่น ๆ เกี่ยวข้องกับข้อมูลของวันนี้และต้องการการเข้าถึงธุรกรรมแต่ละรายการอย่างละเอียด ให้สร้างแบบจำลองสองแบบที่ปรับให้หมาะสมสำหรับแต่ละความต้องการแทนการออกแบบแบบจำลองเดียวเพื่อให้ตรงกับรายงานทั้งหมด

พิจารณาความเป็นไปได้ในการปรับให้เหมาะสมที่สุดสำหรับแบบจำลอง DirectQuery ตามแบบจำลองปัญหาคำขอแบบสอบถามกับแหล่งข้อมูลต้นแบบ ปรับให้เหมาะสม datasource เป็นสิ่งสำคัญในการส่งแบบสอบถามแบบจำลองแบบตอบสนอง

 ![ความเป็นไปได้ในการปรับให้เหมาะสมที่สุดสำหรับแบบจำลอง DirectQuery](media/service-premium-capacity-optimize/direct-query-model-optimizations.png)

ในเลเยอร์แหล่งข้อมูล:

- แหล่งข้อมูลสามารถถูกปรับให้เหมาะสมเพื่อให้แน่ใจเร็วที่สุดสามารถสอบถาม โดยการรวมข้อมูล (ซึ่งจะเป็นไปได้ที่เลเยอร์แบบจำลองไม่), ใช้ดัชนีที่เหมาะสมไว้ล่วงหน้า กำหนดพาร์ติชันตาราง การแสดงข้อมูลสรุป (มีดัชนีมุมมอง), และ ลดจำนวนการคำนวณ ประสบการณ์ดีจะทำได้เมื่อต้องการคิวรีแบบพาส-ทรูกรองเท่านั้น และดำเนินการรวมภายในระหว่างทำดัชนีตารางหรือมุมมอง
- ให้แน่ใจว่า เกตเวย์มีทรัพยากรเพียงพอ อาจเป็นบนเครื่องเฉพาะ มีแบนด์วิดธ์เครือข่ายเพียงพอ และ ในความใกล้เคียงปิดแหล่งข้อมูล

ในเลเยอร์แบบจำลอง:

- คิวรี Power Query ที่ออกแบบควรควรนำไปใช้ไม่มีการแปลง - มิฉะนั้น ความพยายามที่จะเก็บการแปลงเป็นแบบสัมบูรณ์น้อยที่สุด
- สามารถปรับปรุงประสิทธิภาพของการคิวรีแบบจำลองได้โดยการกำหนดค่าความสัมพันธ์ทิศทางเดียว เว้นแต่ว่ามีเหตุผลที่น่าสนใจเพื่อให้สามารถกรองแบบสองทิศทางได้ ยัง ควรกำหนดค่าความสัมพันธ์แบบจำลองการคาดการณ์บังคับใช้ referential integrity (เมื่อเป็นกรณีนี้) และจะทำให้คิวรีแหล่งข้อมูลโดยใช้การรวมภายในมีประสิทธิภาพมากขึ้น (แทนการรวมภายนอก)
- หลีกเลี่ยงการสร้างคอลัมน์แบบกำหนดเองของคิวรี Power Query หรือคอลัมน์จากการคำนวณแบบจำลอง - เพียงกาสร้างเหล่านี้ในแหล่งข้อมูล เมื่อเป็นไปได้
- อาจมีโอกาสในการปรับแต่งนิพจน์ DAX สำหรับหน่วยวัดและกฎ RLS อาจเขียนตรรกะเพื่อหลีกเลี่ยงสูตรที่มีราคาแพง

พิจารณาความเป็นไปได้ในการปรับให้เหมาะสมที่สุดสำหรับแบบจำลองแบบรวม โปรดทราบว่าแบบจำลองแบบรวมจะทำให้เกิดการผสมกันระหว่างตารางการรนำเข้าและตาราง DirectQuery

![ความเป็นไปได้ปรับให้เหมาะสมสำหรับแบบจำลองโดยรวม](media/service-premium-capacity-optimize/composite-model-optimizations.png)

- โดยทั่วไป การปรับให้เหมาะสมสำหรับแบบจำลองที่นำเข้าและ DirectQuery นำไปใช้กับตารางรูปแบบผสมที่ใช้โหมดการเก็บข้อมูลเหล่านี้
- โดยปกติแล้ว พยายามออกแบบให้มีความสมดุลโดยการกำหนดค่าตารางชนิดขนาด (แสดงถึงเอนทิตีธุรกิจ) เป็นโหมดที่เก็บข้อมูลคู่และตารางชนิดข้อเท็จจริง (มักเป็นตารางขนาดใหญ่ซึ่งแสดงถึงข้อเท็จจริงในการปฏิบัติงาน) เป็นโหมดที่เก็บข้อมูลของ DirectQuery โหมดที่เก็บคู่หมายความว่า ทั้งนำเข้า และ DirectQuery เก็บข้อมูลโหมด และซึ่งอนุญาตให้ Power BI service เพื่อระบุโหมดเก็บมีประสิทธิภาพมากที่สุดจะใช้เมื่อสร้างแบบสอบถามสำหรับแบบพาส-ทรู
- ตรวจสอบให้แน่ใจว่าเกตเวย์มีทรัพยากรเพียงพอโดยเฉพาะอย่างยิ่งบนเครื่องเฉพาะที่มีแบนด์วิดท์เครือข่ายเพียงพอและอยู่ใกล้กับแหล่งข้อมูล
- ตารางการรวมที่กำหนดค่าเป็นโหมดที่เก็บข้อมูลแบบนำเข้าสามารถมีผลต่อการปรับปรุงประสิทธิภาพของคิวรีอย่างมากเมื่อใช้เพื่อสรุปตารางชนิดข้อเท็จจริงของโหมดที่เก็บข้อมูลของ DirectQuery ในกรณีนี้ ตารางการรวมจะเพิ่มขนาดของแบบจำลอง และเพิ่มเวลาการรีเฟรช และมักจะเป็นการแลกเปลี่ยนที่ยอมรับได้สำหรับการคิวรีที่เร็วขึ้น

### <a name="optimizing-externally-hosted-models"></a>ปรับให้เหมาะสมภายนอกโฮสต์แบบจำลอง

ความเป็นไปได้ปรับให้เหมาะสมมากมายที่กล่าวถึงในการ[Power BI ที่ปรับให้เหมาะสมโฮสต์แบบจำลอง](#optimizing-power-bi-hosted-models)ส่วนยังนำไปใช้กับแบบจำลองที่พัฒนาขึ้นมา โดย Azure Analysis Services และ SQL Server Analysis Services ข้อยกเว้นที่ชัดเจนคือคุณสมบัติบางอย่างที่ไม่รองรับในปัจจุบัน รวมถึงแบบจำลองแบบรวมและตารางการรวม

ข้อพิจารณาเพิ่มเติมสำหรับชุดข้อมูลที่เป็นโฮสต์ภายนอกคือการโฮสต์ฐานข้อมูลที่เกี่ยวข้องกับบริการของ Power BI สำหรับ Azure Analysis Services หมายถึงการสร้างทรัพยากร Azure ในภูมิภาคเดียวกับผู้เช่า Power BI (ภูมิภาคหลัก) สำหรับ SQL Server Analysis Services หมายถึงการโฮสต์ VM ในภูมิภาคเดียวกันสำหรับ IaaS และหมายถึงการรับประกันการตั้งค่าเกตเวย์ที่มีประสิทธิภาพภายในองค์กร

นอกจากนี้ยังควรที่จะทราบว่าฐานข้อมูล Azure Analysis Services และฐานข้อมูลแบบตาราง SQL Server Analysis Services ต้องการให้โหลดแบบจำลองทั้งหมดลงในหน่วยความจำ และเก็บข้อมูลแบบจำลองเหล่านั้นไว้ในหน่วยความจำตลอดเวลาเพื่อรองรับการคิวรี เหมือนกับบริการของ Power BI ต้องมีหน่วยความจำเพียงพอสำหรับการรีเฟรชหากแบบจำลองยังคงต้องออนไลน์ในระหว่างการรีเฟรช แตกต่างจากบริการของ Power BI ไม่มีแนวคิดว่าแบบจำลองจะคำนวณอายุโดยอัตโนมัติ ทั้งในและนอกหน่วยความจำตามการใช้งาน Power BI Premium จึงเสนอวิธีการมีประสิทธิภาพมากกว่าในการเพิ่มการคิวรีแบบจำลองที่มีการใช้หน่วยความจำต่ำ

## <a name="capacity-planning"></a>วางแผนกำลังการผลิต

ขนาดความจุแบบพรีเมียมจะกำหนดหน่วยความจำที่มีอยู่และทรัพยากรตัวประมวลผล รวมถึงขีดจำกัดที่กำหนดไว้ในความจุ จำนวนของความจุแบบพรีเมียมยังเป็นข้อควรพิจารณาเนื่องจากการสร้างความจุแบบพรีเมียมหลายตัวสามารถช่วยแยกปริมาณงานจากกันได้ โปรดทราบว่าที่เก็บข้อมูลคือ 100 TB ต่อโหนดความจ ุและน่าจะเพียงพอสำหรับปริมาณงานต่าง ๆ

การกำหนดขนาดและจำนวนของความจุแบบพรีเมียมสามารถทำได้ยาก โดยเฉพาะสำหรับความจุเริ่มต้นที่คุณสร้าง ขั้นตอนแรกเมื่อการกำหนดขนาดความจุคือการทำความเข้าใจปริมาณงานเฉลี่ยที่แสดงถึงการใช้งานแบบวันต่อวันที่คาดไว้ สิ่งสำคัญคือต้องเข้าใจว่า ปริมาณงานทั้งหมดไม่มีเท่านั้น ตัวอย่างเช่น ที่ปลายด้านหนึ่งของสเปกตรัม ผู้ใช้พร้อมกัน 100 คนที่เข้าถึงรายงานหน้าเดียวที่มีวิชวลเดียวสามารถทำได้อย่างง่ายดาย ขณะที่อีกปลายด้านหนึ่งของสเปกตรัม ผู้ใช้พร้อมกัน 100 คนที่เข้าถึงรายงานที่แตกต่างกัน 100 ฉบับที่มีวิชวล 100 รายการบนหน้ารายงาน จะส่งผลให้ความต้องการใช้ทรัพยากรความจุแตกต่างกันอย่างมาก

ดังนั้นผู้ดูแลระบบความจุจะต้องพิจารณาปัจจัยหลายอย่างที่เฉพาะเจาะจงกับสภาพแวดล้อม เนื้อหา และการใช้งานที่คาดหวัง วัตถุประสงค์ที่สำคัญคือการเพิ่มการใช้งานความจุให้ได้มากที่สุดในขณะที่เวลาการคิวรี เวลารอที่ยอมรับได้ และอัตราการลดสัดส่วนสอดคล้องกัน ปัจจัยในการพิจารณาอาจรวมถึง

- **แบบจำลองข้อมูลและขนาดลักษณะ**-นำเข้าแบบจำลองต้องโหลดลงในหน่วยความจำเพื่ออนุญาตให้รีเฟรช หรือการสอบถาม ชุดข้อมูล LC/DQ สามารถใช้เวลาของตัวประมวลผลที่สำคัญ และอาจต้องมีหน่วยความจำที่สำคัญในการประเมินการวัดผลที่ซับซ้อนหรือกฎ RLS หน่วยความจำ และขนาดของตัวประมวลผล และอัตราความเร็วของการคิวรี LC/DQ ถูกจำกัดโดยขนาดความจุ
- **แบบจำลองที่ใช้งานอยู่พร้อมกัน**-แบบสอบถามของแบบจำลองการนำเข้าที่แตกต่างกันพร้อมกันจะส่งตอบสนองและประสิทธิภาพการทำงานที่ดีที่สุดเมื่อพวกเขายังคงอยู่ในหน่วยความจำ ควรมีหน่วยความจำเพียงพอที่จะโฮสต์แบบจำลองที่มีการคิวรีอย่างหนักทั้งหมด พร้อมหน่วยความจำเพิ่มเติมเพื่ออนุญาตให้มีการรีเฟรช
- **นำเข้าการรีเฟรชแบบจำลอง**-รีเฟรชชนิด (แบบเต็ม หรือแบบเพิ่มหน่วย), ระยะเวลา และความซับซ้อนของคิวรี Power Query และตรรกะตาราง/คอลัมน์จากการคำนวณสามารถส่งผลกระทบในหน่วยความจำและการใช้ตัวประมวลผลโดยเฉพาะได้ การรีเฟรชพร้อมกันจะจำกัดตามขนาดความจุ (1.5 x วี-คอร์ Backend โดยปัดเศษขึ้น)
- **คิวรีพร้อมกัน**-คิวรีพร้อมกันจำนวนมากสามารถส่งผลในไม่ตอบสนองรายงานเมื่อประมวลผลหรือ LC/DQ เชื่อมต่อเกินขีดจำกัดกำลังการผลิตได้ โดยเฉพาะอย่างยิ่งกรณีสำหรับหน้ารายงานที่มีวิชวลจำนวนมาก
- **Dataflows และรายงานแบบแบ่งหน้า**-ความจุสามารถกำหนดค่าเพื่อสนับสนุน dataflows และรายงานแบบแบ่งหน้า กับแต่ละชนิดสามารถกำหนดค่าเปอร์เซ็นต์สูงสุดของหน่วยความจำได้ หน่วยความจำแบบไดนามิกจัดสรรให้กับ dataflows แต่สาธิตจัดสรรให้กับรายงานแบบแบ่งหน้า

นอกเหนือจากปัจจัยเหล่านี้ ผู้ดูแลระบบความจุสามารถพิจารณาการสร้างความจุหลายอย่าง ความจุหลายอย่างช่วยให้สามารถแยกปริมาณงานได้ และสามารถกำหนดค่าเพื่อให้แน่ใจว่าปริมาณงานที่สำคัญมีแหล่งทรัพยากรที่รับประกัน ตัวอย่างเช่น คุณสามารถสร้างความจุสองอย่างเพื่อแยกปริมาณงานทางธุรกิจที่สำคัญออกจากปริมาณงาน BI แบบบริการตนเอง (SSBI) ความจุทางธุรกิจที่สำคัญสามารถนำมาใช้เพื่อแยกแบบจำลองขององค์กรขนาดใหญ่ที่มีแหล่งทรัพยากรที่รับประกัน โดยการกำหนดสิทธิ์การเข้าถึงที่มอบเฉพาะกับแผนก IT เท่านั้น ความจุ SSBI สามารถใช้เพื่อโฮสต์แบบจำลองขนาดเล็กกว่าที่มีจำนวนเพิ่มขึ้น พร้อมด้วยสิทธิ์การเข้าถึงที่มอบให้กับนักวิเคราะห์ธุรกิจ ความจุ SSBI ในบางครั้งอาจมีการรอคิวรีหรือรีเฟรชที่ยอมรับได้

เมื่อเวลาผ่านไป ผู้ดูแลระบบความจุสามารถปรับสมดุลพื้นที่ทำงานทั่วทั้งความจุโดยการย้ายเนื้อหาระหว่างพื้นที่ทำงานหรือพื้นที่ทำงานระหว่างความจุและโดยการเพิ่มหรือลดขนาดของขนาด โดยทั่วไปแล้ว การโฮสต์แบบจำลองมีขนาดใหญ่คุณมาตราส่วนค่า และ สำหรับภาวะพร้อมกันสูงคุณปรับมาตราส่วนออก

โปรดทราบการซื้อสิทธิ์การใช้งานจะมีวี-คอร์ให้กับผู้เช่า การซื้อการสมัครใช้งาน **P3** สามารถใช้เพื่อสร้างความจุแบบพรีเมียมหนึ่งแบบหรือสูงสุดสี่แบบ เช่น 1 x P3 หรือ 2 x P2 หรือ 4 x P1 ได้ นอกจากนี้ ก่อนที่จะเพิ่มขนาดความจุ P2 เป็นความจุ P3 คุณสามารถพิจารณาการแยกวี-คอร์เพื่อสร้างความจุ P1 สองแบบ

## <a name="testing-approaches"></a>ทดสอบวิธี

เมื่อตัดสินใจเลือกขนาดความจุแล้ว การทดสอบสามารถทำได้โดยการสร้างสภาพแวดล้อมที่มีการควบคุม ตัวเลือกที่ใช้ได้จริงและประหยัดคือการสร้างความจุ Azure (A SKUs) โดยสังเกตว่าความจุ P1 มีขนาดเท่ากับความจุ A4 ขณะที่ความจุ P2 และ P3 มีขนาดเท่ากับความจุ A5 และ A6 ตามลำดับ ความจุ Azure สามารถสร้างได้อย่างรวดเร็วและมีการเรียกเก็บเงินเป็นรายชั่วโมง ดังนั้นเมื่อการทดสอบเสร็จสิ้น สามารถลบความจุเหล่านี้ได้อย่างง่ายดายเพื่อหยุดค่าใช้จ่ายที่เกิดขึ้น

สามารถเพิ่มเนื้อหาการทดสอบลงในพื้นที่ทำงานที่สร้างขึ้นบนความจุ Azure จากนั้นในฐานะผู้ใช้รายเดียวสามารถเรียกใช้รายงานเพื่อสร้างปริมาณงานที่เป็นจริงและเป็นตัวแทนของคิวรี ถ้ามีแบบจำลองการนำเข้า ควรดำเนินการรีเฟรชสำหรับแต่ละแบบจำลองด้วย จากนั้นสามารถใช้เครื่องมือการตรวจสอบในการตรวจสอบเมตริกทั้งหมดเพื่อทำความเข้าใจการใช้ทรัพยากร

เป็นสิ่งสำคัญที่การทดสอบจะทำซ้ำได้ ควรทำการทดสอบหลายครั้งและควรให้ผลลัพธ์ประมาณเดียวกันในแต่ละครั้ง ค่าเฉลี่ยของผลลัพธ์เหล่านี้สามารถใช้เพื่อคาดการณ์และประเมินปริมาณงานภายใต้เงื่อนไขการผลิตจริง

หากต้องสร้างการทดสอบปัญหา ให้ลองพัฒนาแอปพลิเคชันการทดสอบโหลดเพื่อจำลองปริมาณงานจริง รายละเอียดของวิธีการนี้อยู่นอกขอบเขตของบทความนี้ สำหรับข้อมูลเพิ่มเติมรวมถึงตัวอย่างโค้ด ดู[โหลดแอปพลิเคชัน Power BI ทดสอบกับ Visual Studio load test](https://blogs.msdn.microsoft.com/charles_sterling/2018/04/04/webinar-load-testing-power-bi-applications-with-visual-studio-load-test/)สัมมนาผ่านเว็บ

## <a name="acknowledgements"></a>ดูล

บทความนี้ถูกเขียน โดย Peter Myers, MVP แพลตฟอร์มข้อมูล และผู้เชี่ยวชาญ BI อิสระด้วย[โซลูชันแบบ Bitwise](https://www.bitwisesolutions.com.au/)

## <a name="next-steps"></a>ขั้นตอนถัดไป

> [!div class="nextstepaction"]
> [สถานการณ์ความจุ premium](service-premium-capacity-scenarios.md)   
  
มีคำถามเพิ่มเติมหรือไม่? [ลองถามชุมชน Power BI](https://community.powerbi.com/)

||||||